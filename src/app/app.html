<div class="info-panel">Welcome to the chat!</div>

<div class="chat-container">
  <div class="messages" (scroll)="onScroll()" #messagesContainer>
    @for (message of chatService.messages(); track message.timestamp) {
    <div class="message-row" [class]="message.type">
      <div class="timestamp">{{ message.timestamp | timeAgo }}</div>
      <div class="message">
        <div class="text" [innerHTML]="message.parsedText"></div>
      </div>
    </div>
    }

    @if (streamingInProgress()) {
      <div class="message-row received">
        <div class="message">
          <div class="text" [innerHTML]="chatService.getParsedHtml(currentStreamMessage())"></div>
          <div class="loading-indicator">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
          </div>
        </div>
      </div>
    }

    @if (loading() && !streamingInProgress()) {
      <div class="message-row received">
        <div class="message">
          <div class="loading-indicator">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
          </div>
        </div>
      </div>
    }
  </div>

  <form (ngSubmit)="sendMessage()">
    <input
      [(ngModel)]="message"
      name="message"
      placeholder="Type a message..."
      autofocus
      [disabled]="streamingInProgress() || loading()"
    />
    <button type="submit" [disabled]="streamingInProgress() || loading()">Send</button>
    <button class="clear-chat" (click)="clearChat()" [disabled]="streamingInProgress() || loading()">Clear Chat</button>
  </form>

  <button class="jump-to-bottom" [class.show]="showJumpToBottomButton()" (click)="scrollToBottom()">
    Jump to Bottom &darr;
  </button>
</div>
